# リリース日単位でリリースノートを作成（productionへのプルリクを対象とする）
name: Auto generate release note by release date 
on: 
  #push:
  #pull_request:
  #  types: closed
    #branches: production
  workflow_dispatch:
    inputs:
      releaseDate:
        description: 'リリース日'
        required: true
        type: string

jobs:
  create-release-note:
    runs-on: ubuntu-latest
    steps:
      - name: create branch list
        uses: actions/github-script@v6
        with:
          script: |
            const pullRequests = await github.rest.pulls.list({
                                   owner: context.repo.owner,
                                   repo: context.repo.repo,
                                   //head: 'main',
                                   //base: 'develop/Test',
                                   state: 'close'
                               });
            // プルリク本文未記入＋リリース日マッチしないプルリクは除外
            const targetPullRequests = pullRequests.data.filter(pullRequest => pullRequest.body && pullRequest.body.match(/${{ inputs.releaseDate }}/));

            if (!targetPullRequests) {
                console.log("リリースノート記入対象なし");
                return;
            }
            
            console.log(!targetPullRequests ?  : "リリースノート記入対象プルリク数：" + targetPullRequests.length);
            console.log("リリースノート記入対象プルリク数：" + targetPullRequests.length);
            //const releaseNoteFormat((pullRequestNumber, pullRequestTitle) => "#" + pullRequestNumber + " " + pullRequestTitle);
            //targetPullRequests.forEach(target => console.log(releaseNoteFormat(target.number, target.title)));
            // head: fromブランチ、 base: toブランチ
